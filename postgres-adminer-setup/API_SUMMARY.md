# üìä SGR PostgreSQL API - –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ –î–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—É–±—Ä–∞–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger UI)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 2. –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### `/api/tables` - –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` (int, default=1) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `page_size` (int, default=10, max=100) - —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –¢–∏–ø —Ç–∞–±–ª–∏—Ü—ã
- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–∞–±–ª–∏—Ü–µ** ‚≠ê

#### `/api/tables/{table_name}/schema` - –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–∞–±–ª–∏—Ü–µ** ‚≠ê
- –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ —Å:
  - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
  - –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö
  - Nullable/Not Null
  - Primary Key / Foreign Key
  - **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∫–æ–ª–æ–Ω–∫–µ** ‚≠ê
- –°–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫

### 3. Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–∏–π –æ–±—Ä–∞–∑ –Ω–∞ –±–∞–∑–µ Alpine Linux
- ‚úÖ –ü–æ—Ä—Ç 18790 (–∫–∞–∫ –∑–∞–ø—Ä–æ—à–µ–Ω–æ)
- ‚úÖ **Hot-reload** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
- ‚úÖ Volume –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ Health checks
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PostgreSQL

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
cd /srv/sgr-agetn-core-tool-search-context-compression/postgres-adminer-setup
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
curl http://localhost:18790/health
curl "http://localhost:18790/api/tables?page=1&page_size=5"
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ `./api/`
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
3. –ß–µ—Ä–µ–∑ 2-3 —Å–µ–∫—É–Ω–¥—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è

**–ù–µ –Ω—É–∂–Ω–æ:**
- ‚ùå `docker compose build`
- ‚ùå `docker compose restart`

## üì¶ –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | URL |
|--------|------|-----|
| PostgreSQL | 18788 | `localhost:18788` |
| Adminer | 18789 | `http://localhost:18789` |
| **API** | **18790** | `http://localhost:18790` |
| API Docs | 18790 | `http://localhost:18790/docs` |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
postgres-adminer-setup/
‚îú‚îÄ‚îÄ api/                          # üî• –ö–æ–¥ API (volume)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ database.py               # –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ auth.py                   # –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ Dockerfile.api                # Dockerfile –¥–ª—è API
‚îú‚îÄ‚îÄ requirements.txt              # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ API_QUICK_START.md            # üìñ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ API_README.md                 # üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ test_api.sh                   # üß™ –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python
```python
import requests

# –ü–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
response = requests.get('http://localhost:18790/api/tables', 
                       params={'page': 1, 'page_size': 10})
tables = response.json()

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É
response = requests.get('http://localhost:18790/api/tables/app_logs/schema')
schema = response.json()
print(schema['table_comment'])  # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–∞–±–ª–∏—Ü–µ
```

### JavaScript
```javascript
// –ü–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
fetch('http://localhost:18790/api/tables?page=1&page_size=10')
  .then(res => res.json())
  .then(data => console.log(data));

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É
fetch('http://localhost:18790/api/tables/app_logs/schema')
  .then(res => res.json())
  .then(schema => console.log(schema.table_comment));
```

### cURL
```bash
# –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
curl "http://localhost:18790/api/tables?page=1&page_size=5"

# –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã
curl "http://localhost:18790/api/tables/app_logs/schema"
```

## üîç –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ API
docker compose logs -f api

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
docker compose logs --tail=50 api

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose logs -f
```

## üìä –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

```json
{
  "tables": [
    {
      "table_name": "app_logs",
      "table_type": "BASE TABLE",
      "table_size": "96 kB",
      "column_count": 8,
      "table_comment": "–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π"
    }
  ],
  "pagination": {
    "page": 1,
    "page_size": 10,
    "total_count": 8,
    "total_pages": 1
  }
}
```

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **Hot-reload** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º –∏ –∫–æ–ª–æ–Ω–∫–∞–º
3. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏
4. **–õ–µ–≥–∫–∏–π –æ–±—Ä–∞–∑** - Alpine Linux, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
5. **–ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
6. **–ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - Swagger UI –∏–∑ –∫–æ—Ä–æ–±–∫–∏

## üéì –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** 0.115.6 - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **asyncpg** 0.30.0 - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
- **uvicorn** 0.34.0 - ASGI —Å–µ—Ä–≤–µ—Ä —Å hot-reload
- **pydantic** 2.10.4 - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **PostgreSQL** 18 - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
